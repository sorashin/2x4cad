# プロジェクトコンテキスト

## 概要
- プロジェクト名: 2x4cad
- 技術スタック: React + TypeScript + Three.js + react-three-fiber
- 目標: 2x4材などの角材を使った構造物を3Dで設計できるCADアプリケーション

## 制約条件
- ブラウザベースの3DアプリケーションとしてWebで動作
- リアルタイムな3D描画とインタラクションが必要
- UNDO/REDO機能は必須

## 技術選定理由

### 状態管理
- **Zustand**: シンプルで軽量な状態管理ライブラリ
  - `useLumberStore`: 角材データ（追加/更新/削除/選択状態）を管理
  - `useHistoryStore`: UNDO/REDO履歴を管理
- **History Pattern (Class-based)**: 完全なUNDO/REDO対応とコードの拡張性

### 3Dレンダリング
- **Three.js + react-three-fiber**: React統合とパフォーマンス
- **@react-three/drei**: TransformControls、OrbitControls、Grid等の便利なヘルパー

### データモデル
- **角材の表現**: 始点座標 + 長さ + 回転（Quaternion）で表現
- **接続情報**: 角材同士の接続関係（ビス止め/金具/接触）を記録可能
- **プロジェクトデータ**: JSON形式でインポート/エクスポート可能な設計

## アーキテクチャの背景

### クラスベース History Pattern の採用

**設計方針**:
- 各操作（追加/更新/削除）をHistoryクラスとして実装
- `HistoryBase`インターフェースで統一されたUNDO/REDO
- 複合操作は`NestedHistory`で複数の履歴をグループ化

**利点**:
1. 操作と履歴管理が明確に分離
2. 新しい操作を追加する際に`HistoryBase`を実装するだけ
3. 複雑な操作も`NestedHistory`で簡単に実装可能
4. テストが容易

### Three.js座標系とアプリケーション座標系

**背景**:
- アプリケーション内部は**mm単位**で管理（実際の建築で使われる単位）
- Three.jsのシーンは**10cm単位**で管理（グリッドとの対応）
- 変換係数: `mmToUnits` / `unitsToMm` で相互変換

**理由**:
1. 実際の建築図面はmm単位
2. Three.jsのシーンは見やすいスケール（100mm = 1単位）
3. 数値の精度を保つため内部はmm単位で保持

### UIデザインとアイコンシステム

**背景**:
- Tailwind CSSを使用したユーティリティファーストのスタイリング
- SVGアイコンを使った直感的なUI
- ダークモード対応のカラーパレット

**実装方針**:
1. **アイコンコンポーネント**: 再利用可能なSVGアイコンコンポーネント
   - `Icon.tsx`: 統一されたアイコン管理
   - サイズやカラーをpropsで制御可能

2. **レスポンシブデザイン**: 画面サイズに応じた適応
   - ツールバーの配置調整
   - モバイル対応を考慮

3. **視覚的フィードバック**: ユーザー操作の明確化
   - ホバー効果
   - アクティブ状態の表示
   - トランジション効果
