# 2x4cad プロジェクト設定

## プロジェクト概要

2x4材などの角材を使った構造物を3Dで設計できるCADアプリケーション

## 技術スタック

- **フレームワーク**: React 18 + TypeScript + Vite
- **3Dレンダリング**: Three.js + react-three-fiber + @react-three/drei
- **状態管理**: Zustand
- **スタイリング**: Tailwind CSS
- **開発サーバー**: Vite

## プロジェクト構造

```
src/
├── components/          # Reactコンポーネント
│   ├── Scene.tsx       # メイン3Dシーン
│   ├── Lumber.tsx      # 角材コンポーネント
│   └── Icon.tsx        # アイコンコンポーネント
├── stores/             # Zustand状態管理
│   ├── lumber.ts       # 角材データストア
│   └── history.ts      # UNDO/REDO履歴ストア
├── histories/          # History Pattern実装
│   ├── HistoryBase.ts  # Historyインターフェース
│   ├── AddLumberHistory.ts
│   ├── UpdateLumberHistory.ts
│   └── NestedHistory.ts
├── types/              # TypeScript型定義
│   └── lumber.ts       # 角材型定義
├── constants.ts        # 定数定義
├── App.tsx            # アプリケーションルート
└── main.tsx           # エントリーポイント
```

## 重要な設計方針

### 1. History Pattern によるUNDO/REDO
- すべての操作は `HistoryBase` インターフェースを実装
- 各操作をクラスとして実装し、完全なUNDO/REDO機能を提供
- 複合操作は `NestedHistory` でグループ化

### 2. 単位の統一
- **アプリケーション内部**: mm単位で管理
- **Three.jsシーン**: 100mm = 1単位で変換
- 変換関数: `mmToUnits()` / `unitsToMm()`

### 3. 角材の表現
- **データ構造**: 始点座標 + 長さ + Quaternion回転
- TransformControls と相性が良く、任意の3D回転を表現可能

## コーディング規約

### TypeScript
- 厳格な型定義を使用
- `interface` を優先（拡張可能性のため）
- `enum` は文字列列挙型を使用

### コンポーネント
- 関数コンポーネントを使用
- パフォーマンスが重要な箇所は `memo` でメモ化
- カスタムフックで共通ロジックを抽出

### 状態管理
- Zustandでグローバル状態を管理
- ローカル状態は `useState` / `useRef`
- 履歴管理は `useHistoryStore` で統一

### ファイル命名
- コンポーネント: PascalCase（例: `Scene.tsx`）
- ユーティリティ: camelCase（例: `constants.ts`）
- 型定義: camelCase（例: `lumber.ts`）

## 開発コマンド

```bash
# 開発サーバー起動
pnpm run dev

# ビルド
pnpm run build

# プレビュー
pnpm run preview

# 型チェック
pnpm run typecheck
```

## 参考ドキュメント

- [React Three Fiber](https://docs.pmnd.rs/react-three-fiber)
- [Three.js](https://threejs.org/docs/)
- [@react-three/drei](https://github.com/pmndrs/drei)
- [Zustand](https://docs.pmnd.rs/zustand)
